<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pescaria No Brasil</title>
    <script src="./js/sessao.js"></script>
    <link rel="stylesheet" href="./css/style_cadlog.css">
</head>
<body>
    <div class="bg">
        <img src="./assets/boat2.gif" alt="">
    </div>
    <div class="containercadastro">
        <p> Nome completo:</p>
        <input type="text" placeholder="Ex: João Pedro" id="iptNome">
        <p>E-mail:</p>
        <input type="text" placeholder="seuemail@provedor.com.br" id="iptEmail">
        <p>Senha:</p>
        <input type="password" placeholder="•••••••••" id="iptSenha">
        <p>Confirme sua senha:</p>
        <input type="password" placeholder="•••••••••" id="iptConfirma">
        <div>
            <a href="./index.html"><button>Voltar</button></a> <button onclick="cadastrar()">Cadastrar</button>
        </div>
        <div class="revisao" id="divRevisao">
            <p>Revise os campos em vermelho!</p>
        </div>
        <div>
            <a href="./login.html"><p>Já possui uma conta? Clique aqui para fazer login.</p></a>
        </div>
    </div>
</body>
</html>

<script>
  function cadastrar() {

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nome = iptNome.value;
    var email = iptEmail.value;
    var senha = iptSenha.value;
    var confirmacao = iptConfirma.value;

    if (
      nome == "" ||
      email == "" ||
      senha == "" ||
      confirmacao == ""
    ) return; 
    
    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nome: nome,
        email: email,
        senha: senha,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {

          setTimeout(() => {
            window.location = "index.html";
          }, "2000");
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return;
  }

</script>